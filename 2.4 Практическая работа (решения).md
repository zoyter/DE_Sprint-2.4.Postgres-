### Практическая работа № 10

1. Чтобы успешно справиться с данным практическим заданием, вам необходимо выполнить как минимум задания 1-4 практики в теме 2.3 "Реляционные базы данных: PostgreSQL", но желательно сделать, конечно же, все.

2. Теперь мы знакомы с гораздо большим перечнем операторов языка SQL и это дает нам дополнительные возможности для анализа данных. Выполните следующие запросы:

a. Попробуйте вывести не просто самую высокую зарплату во всей команде, а вывести именно фамилию сотрудника с самой высокой зарплатой.

```sql
SELECT
    fio
FROM
    staff
WHERE
    salary = (
        SELECT MAX(salary)
        FROM  staff
    );
```

b. Попробуйте вывести фамилии сотрудников в алфавитном порядке

```sql
SELECT DISTINCT
    fio
FROM
    staff;
```

c. Рассчитайте средний стаж для каждого уровня сотрудников

```sql
SELECT
    level, AVG(CURRENT_DATE - begin_date) AS career
FROM
    staff
GROUP BY level;

```

d. Выведите фамилию сотрудника и название отдела, в котором он работает

```sql
ALTER TABLE staff ADD FOREIGN KEY (id_depart) REFERENCES departments;

SELECT
    staff.fio, departments.name
FROM
    staff, departments
WHERE
    staff.id_depart =  departments.id_depart;

```

e. Выведите название отдела и фамилию сотрудника с самой высокой зарплатой в данном отделе и саму зарплату также.
```sql
SELECT
    d.name, s.fio, MAX(s.salary) AS max_salary
FROM
    departments d, staff s
WHERE
    d.id_depart =  s.id_depart
    AND
    salary IN (
        SELECT MAX(salary)
        FROM  staff
        GROUP BY id_depart
        )
GROUP BY d.name, s.fio;

```


f. **Выведите название отдела, сотрудники которого получат наибольшую премию по итогам года. Как рассчитать премию можно узнать в последнем задании предыдущей домашней работы**

```sql

```

g. **Проиндексируйте зарплаты сотрудников с учетом коэффициента премии. Для сотрудников с коэффициентом премии больше 1.2 – размер индексации составит 20%, для сотрудников с коэффициентом премии от 1 до 1.2 размер индексации составит 10%. Для всех остальных сотрудников индексация не предусмотрена.**

```sql

```
h. **По итогам индексации отдел финансов хочет получить следующий отчет: вам необходимо на уровень каждого отдела вывести следующую информацию:**

    i. **Название отдела

```sql

```
    ii. Фамилию руководителя

```sql

```
    iii. Количество сотрудников

```sql

```
    iv. Средний стаж

```sql

```
    v. Средний уровень зарплаты

```sql

```
    vi. Количество сотрудников уровня junior

```sql

```
    vii. Количество сотрудников уровня middle

```sql

```
    viii. Количество сотрудников уровня senior

```sql

```
    ix. Количество сотрудников уровня lead

```sql

```
    x. Общий размер оплаты труда всех сотрудников до индексации

```sql

```
    xi. Общий размер оплаты труда всех сотрудников после индексации

```sql

```
    xii. Общее количество оценок А

```sql

```
    xiii. Общее количество оценок B

```sql

```
    xiv. Общее количество оценок C

```sql

```
    xv. Общее количество оценок D

```sql

```
    xvi. Общее количество оценок Е

```sql

```
    xvii. Средний показатель коэффициента премии

```sql

```
    xviii. Общий размер премии.

```sql

```
    xix. Общую сумму зарплат(+ премии) до индексации

```sql

```
    xx. Общую сумму зарплат(+ премии) после индексации(премии не индексируются)

```sql

```
    xxi. Разницу в % между предыдущими двумя суммами(первая/вторая)**

```sql

```

**Задача со (*) - для обучающихся в группе 1Т ИД когорта Pro.**

**По итогам работы вам необходимо запушить код запросов к БД в отдельный репозиторий (github/gitlab) и приложить ссылку.**

